# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—É–¥–æ—Ö–æ–¥–Ω—ã—Ö –ª–∏–Ω–∏–π

## üìù –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å—É–¥–æ—Ö–æ–¥–Ω—ã—Ö –ª–∏–Ω–∏–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ `BaseLine` –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –ª–∏–Ω–∏–∏. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –æ—Ç 40+ —Å—É–¥–æ—Ö–æ–¥–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π.

## üèõÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### üß± –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º
- **–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `BaseLine`** —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—â—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Admiral`) –Ω–∞—Å–ª–µ–¥—É—é—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤** –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫–∞–∂–¥–æ–π –ª–∏–Ω–∏–∏

### üîÑ –ï–¥–∏–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏
1. **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞** - —É–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –∏ –∫–æ–ª–æ–Ω–æ–∫
2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** - –¥–∞—Ç–∞, —Å—É–¥–Ω–æ, —Ä–µ–π—Å –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
3. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** - –ø–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü
4. **–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
5. **–û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ API
6. **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞** - —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
7. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** - —ç–∫—Å–ø–æ—Ä—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤

### üèóÔ∏è BaseLine - –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å

```python
class BaseLine:
    """
    –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö —Å—É–¥–æ—Ö–æ–¥–Ω—ã—Ö –ª–∏–Ω–∏–π
    –°–æ–¥–µ—Ä–∂–∏—Ç –æ–±—â—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
    """
    
    def __init__(self, input_file_path: str, output_folder: str, line_file: str):
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–µ–π –∏ –ª–æ–≥–≥–µ—Ä–∞
        
    # –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏:
    def main() -> int                              # –ì–ª–∞–≤–Ω—ã–π –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    def remove_empty_columns_and_rows() -> str     # –û—á–∏—Å—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    def create_parsed_data_and_context() -> tuple  # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    def check_errors_in_header()                   # –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    def parse_row()                               # –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    def write_data_in_file()                      # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSON
    
    # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
    def is_digit() -> bool                        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    def merge_two_dicts() -> dict                 # –°–ª–∏—è–Ω–∏–µ —Å–ª–æ–≤–∞—Ä–µ–π
    def remove_symbols_in_columns() -> str        # –û—á–∏—Å—Ç–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    def fill_data_with_duplicate_containers()     # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```

### üö¢ Admiral - –ü—Ä–∏–º–µ—Ä —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞

```python
class Admiral(Singleton, BaseLine):
    """
    –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è –ª–∏–Ω–∏–∏ Admiral
    –ù–∞—Å–ª–µ–¥—É–µ—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫—É—é –ª–æ–≥–∏–∫—É
    """
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –¥–∞–Ω–Ω–æ–π –ª–∏–Ω–∏–∏
    dict_columns_position: Dict[str, Union[None, int]] = {
        "number_pp": None,
        "container_size_and_type": None,
        "container_number": None,
        "container_seal": None,
        "goods_weight_with_package": None,
        "package_number": None,
        "goods_name": None,
        "shipper_name": None,
        "tracking_country": None,
        "consignee_name": None,
        "consignment": None,
        "city": None
    }
    
    # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏:
    def parse_date()                              # –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ Admiral
    def parse_content_before_table()              # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    def parse_ship_and_voyage()                   # –ü–∞—Ä—Å–∏–Ω–≥ —Å—É–¥–Ω–∞ –∏ —Ä–µ–π—Å–∞
    def get_columns_position()                    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –∫–æ–ª–æ–Ω–æ–∫
    def add_frequently_changing_keys()            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω—è–µ–º—ã—Ö –ø–æ–ª–µ–π
    def is_table_starting() -> bool               # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ç–∞–±–ª–∏—Ü—ã
```

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞

### 1Ô∏è‚É£ –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```python
def main(self):
    # 1. –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –∏ –∫–æ–ª–æ–Ω–æ–∫
    file_name_save = self.remove_empty_columns_and_rows()
    
    # 2. –û—Å–Ω–æ–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    list_data = self.__get_content_from_file(file_name_save, coefficient_of_header)
    
    # 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    if is_need_duplicate_containers:
        list_data = self.fill_data_with_duplicate_containers(list_data, sign)
```

### 2Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```python
def create_parsed_data_and_context(self, file_name_save, input_file_path):
    # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    date_previous = re.match(r'\d{2,4}.\d{1,2}', os.path.basename(file_name_save))
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
    context = dict(
        line=self.line_file,
        terminal="–ù–£–¢–≠–ü" if os.environ.get('XL_IMPORT_TERMINAL') == "nutep" else "–ù–õ–≠",
        parsed_on=str(datetime.strptime(date_previous, "%Y.%m.%d").date())
    )
    
    # –ß—Ç–µ–Ω–∏–µ CSV –¥–∞–Ω–Ω—ã—Ö
    with open(file_name_save, newline='') as csvfile:
        rows = list(csv.reader(csvfile))
    
    return rows, context
```

### 3Ô∏è‚É£ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏

```python
def process_row(self, row, rows, index, list_data, context, list_columns, coefficient_of_header):
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—Ç—Ä–æ–∫–∏
    if self.get_probability_of_header(row, list_columns) > coefficient_of_header:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
        self.check_errors_in_header(row, context)
        
    elif self.is_table_starting(row):
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        self.get_content_in_table(row, rows, index, list_data, context)
        
    else:
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–¥–∞—Ç–∞, —Å—É–¥–Ω–æ, —Ä–µ–π—Å)
        self.get_content_before_table(row, context, LIST_MONTH)
```

### 4Ô∏è‚É£ –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

```python
def parse_row(self, index, row, rows, context, list_data):
    parsed_record = {}
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π –¥–ª—è –¥–∞–Ω–Ω–æ–π –ª–∏–Ω–∏–∏
    self.add_frequently_changing_keys(row, parsed_record)
    
    # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–æ–ª–µ–π
    record = self.add_value_from_data_to_list(
        row, 
        self.dict_columns_position["container_number"],
        self.dict_columns_position["goods_weight_with_package"],
        self.dict_columns_position["package_number"],
        # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
        parsed_record,
        context
    )
    
    list_data.append(record)
```

### 5Ô∏è‚É£ –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Ä—Ç–∞–º–∏

```python
def get_seaport_from_website(self, list_data):
    if self.line_file in LIST_LINES:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Ä—Ç–æ–≤
        seaport_empty_containers = SeaportEmptyContainers(self.logger_write)
        
        # –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ API
        list_data = self.parsed_line(list_data)
        
        # –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ø—É—Å—Ç—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
        self.get_seaport_from_shipper(seaport_empty_containers, list_data)
```

## üéõÔ∏è –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### üìã –°–ª–æ–≤–∞—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–≤ `__init__.py`)

```python
# –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä—É—Å—Å–∫–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∞–Ω–≥–ª–∏–π—Å–∫–∏–º –ø–æ–ª—è–º
DICT_HEADERS_COLUMN_ENG = {
    ("‚Ññ –ø/–ø", "No", "N –ø/–ø"): "number_pp",
    ("–†–∞–∑–º–µ—Ä –∏ —Ç–∏–ø –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞", "–†–∞–∑–º–µ—Ä/—Ç–∏–ø –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"): "container_size_and_type",
    ("–ù–æ–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞", "‚Ññ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"): "container_number",
    ("–ü–ª–æ–º–±–∞", "‚Ññ –ø–ª–æ–º–±—ã"): "container_seal",
    # ... –¥—Ä—É–≥–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
}

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ñ–∞–π–ª–æ–≤
DICT_CONTENT_BEFORE_TABLE = {
    ("–î–∞—Ç–∞ –ø—Ä–∏—Ö–æ–¥–∞:", "–î–∞—Ç–∞:"): "shipment_date",
    ("–°—É–¥–Ω–æ:", "–ù–∞–∑–≤–∞–Ω–∏–µ —Å—É–¥–Ω–∞:"): "ship_voyage",
    ("–†–µ–π—Å:", "–ù–æ–º–µ—Ä —Ä–µ–π—Å–∞:"): "ship_voyage",
}

# –°–ø–∏—Å–æ–∫ –º–µ—Å—è—Ü–µ–≤ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç
LIST_MONTH = [
    "—è–Ω–≤–∞—Ä—å", "—Ñ–µ–≤—Ä–∞–ª—å", "–º–∞—Ä—Ç", "–∞–ø—Ä–µ–ª—å",
    "–º–∞–π", "–∏—é–Ω—å", "–∏—é–ª—å", "–∞–≤–≥—É—Å—Ç",
    "—Å–µ–Ω—Ç—è–±—Ä—å", "–æ–∫—Ç—è–±—Ä—å", "–Ω–æ—è–±—Ä—å", "–¥–µ–∫–∞–±—Ä—å"
]
```

### üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –ª–∏–Ω–∏–∏

```python
# –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ª–∏–Ω–∏–∏
admiral = Admiral(input_file, output_folder, __file__)
result = admiral.main(
    is_need_duplicate_containers=True,  # –ó–∞–ø–æ–ª–Ω—è—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
    is_reversed=True,                   # –û–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    sign='',                           # –°–∏–º–≤–æ–ª –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    coefficient_of_header=30           # –ü–æ—Ä–æ–≥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ (%)
)
```

## üîç –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

### üìä –ö–æ–¥—ã –æ—à–∏–±–æ–∫

```python
data_error = {
    '1': '–û—à–∏–±–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞—Ç—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞',
    '2': '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ç–æ–ª–±—Ü–∞',
    '3': '–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞—Ç—ã, —Ä–µ–π—Å–∞ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—É–¥–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ',
    '4': '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ JSON —Ñ–∞–π–ª–∞',
    '5': '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã',
    '6': '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤'
}
```

### ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

```python
def get_content_in_table(self, row, rows, index, list_data, context):
    try:
        self.parse_row(index, row, rows, context, list_data)
    except (IndexError, ValueError, TypeError) as ex:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
        self.logger_write.error(f"Error code 5: error processing in row {index + 1}!")
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
        telegram(f'–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–ª–∞ –≤ —Å—Ç—Ä–æ–∫–µ {index + 1} –§–∞–π–ª–∞ {self.input_file_path}.')
        
        # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –∫–æ–¥–æ–º –æ—à–∏–±–∫–∏
        print(f"5_in_row_{index + 1}", file=sys.stderr)
        sys.exit(5)
```

## üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—É–¥–æ—Ö–æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞

```python
# scripts/new_line.py
from BaseLine import BaseLine
from __init__ import *

class NewLine(BaseLine):
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–ª–æ–Ω–æ–∫
    dict_columns_position = {
        "container_number": None,
        "goods_name": None,
        # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —ç—Ç–æ–π –ª–∏–Ω–∏–∏
    }
    
    def parse_date(self, parsing_row, month_list, context, row):
        """–°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π –ª–∏–Ω–∏–∏"""
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã
        pass
    
    def add_frequently_changing_keys(self, row, parsed_record):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π –Ω–æ–≤–æ–π –ª–∏–Ω–∏–∏"""
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        pass
    
    def is_table_starting(self, row):
        """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö"""
        # –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞—á–∞–ª–∞ —Ç–∞–±–ª–∏—Ü—ã
        return bool_condition

if __name__ == '__main__':
    parser = NewLine(sys.argv[1], sys.argv[2], __file__)
    try:
        print(parser.main())
    except Exception as ex:
        telegram(f'–û—à–∏–±–∫–∞ {ex} –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞ {parser.input_file_path}.')
        print("6", file=sys.stderr)
        sys.exit(6)
```

### 2Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ bash —Å–∫—Ä–∏–ø—Ç–∞

```bash
# bash_dir/line_new_line.sh
#!/bin/bash

xls_path="${XL_IDP_PATH_IMPORT}/lines_${XL_IMPORT_TERMINAL}/new_line_tracking"

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–ø–æ–∫
csv_path="${xls_path}"/csv
done_path="${xls_path}"/done
json_path="${xls_path}"/json

mkdir -p "${csv_path}" "${done_path}" "${json_path}"

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
find "${xls_path}" -maxdepth 1 -type f \( -name "*.xls*" -or -name "*.xml" \) ! -newermt '3 seconds ago' -print0 | while read -d $'\0' file
do
    if [[ "${file}" == *"error_"* ]]; then
        continue
    fi
    
    mime_type=$(file -b --mime-type "$file")
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ CSV
    csv_name="${csv_path}/$(basename "${file}").csv"
    if [[ ${mime_type} = "application/vnd.ms-excel" ]]; then
        in2csv -f xls "${file}" > "${csv_name}"
    elif [[ ${mime_type} = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" ]]; then
        in2csv -f xlsx "${file}" > "${csv_name}"
    fi
    
    if [ $? -eq 0 ]; then
        mv "${file}" "${done_path}"
    else
        mv "${file}" "${xls_path}/error_$(basename "${file}")"
        continue
    fi
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç
    exit_message=$(python3 ${XL_IDP_ROOT}/scripts/new_line.py "${csv_name}" "${json_path}" 2>&1 > /dev/null)
    exit_code=$?
    
    if [[ ${exit_code} == 0 ]]; then
        mv "${csv_name}" "${done_path}"
    else
        mv "${csv_name}" "${xls_path}/error_code_${exit_message}_$(basename "${csv_name}")"
    fi
done
```

### 3Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫

```bash
# bash_dir/_all_lines.sh
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
${XL_IDP_ROOT}/bash_dir/line_new_line.sh
```

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### üèóÔ∏è –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - –∫–∞–∂–¥–∞—è –ª–∏–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
- **–ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –≤—Å–µ –∫–ª–∞—Å—Å—ã –Ω–∞—Å–ª–µ–¥—É—é—Ç –æ—Ç BaseLine
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä–∏ –≤ `__init__.py`
- **–õ–µ–≥–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ª–∏–Ω–∏–∏ —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

### üîÑ –ì–∏–±–∫–æ—Å—Ç—å
- **–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤** - –∫–∞–∂–¥–∞—è –ª–∏–Ω–∏—è –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –ª—é–±–æ–π –∞—Å–ø–µ–∫—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–∞ `main()`
- **–£—Å–ª–æ–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Ä–∞–∑–ª–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### üõ°Ô∏è –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—à–∏–±–æ–∫** - 6 —Ç–∏–ø–æ–≤ –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Graceful degradation** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram** - –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –ø–æ—Å—Ç—Ä–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –∏–∑–±–µ–∂–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ü–∞—Ç—Ç–µ—Ä–Ω Singleton** - –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏
- **–õ–µ–Ω–∏–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### üìà –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```python
def main(self) -> int:
    # –û—Å–Ω–æ–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    # ...
    
    # –í–æ–∑–≤—Ä–∞—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    return len(self.count_unique_containers(list_data))
```

### üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
```python
# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
self.logger_write.info(f"Will parse date in value {parsing_row}")
self.logger_write.info(f"context now is {context}")
self.logger_write.info(f"record is {record}")
self.logger_write.info(f"Length is unique containers {len(set_container)}")
```

### üîî –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```python
def telegram(message):
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot API –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```

## üéõÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **coefficient_of_header** (30%) - –ø–æ—Ä–æ–≥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
- **is_need_duplicate_containers** (bool) - –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- **is_reversed** (bool) - –æ–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- **sign** (str) - —Å–∏–º–≤–æ–ª –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
```
lines_terminal/
‚îú‚îÄ‚îÄ line_name_tracking/          # –ü–∞–ø–∫–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –ª–∏–Ω–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ csv/                     # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ CSV —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ done/                    # –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ json/                    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
‚îÇ   ‚îî‚îÄ‚îÄ error_*                  # –§–∞–π–ª—ã —Å –æ—à–∏–±–∫–∞–º–∏
```

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∏ –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å—É–¥–æ—Ö–æ–¥–Ω—ã—Ö –ª–∏–Ω–∏–π —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.